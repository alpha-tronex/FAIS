<main class="page">
  <h1>Financial affidavit</h1>

  <nav class="mt16">
    <a (click)="goBack()" class="link">Back</a>
    <span class="sep">|</span>
    <a [routerLink]="['/affidavit']" [queryParams]="navQueryParams()" class="link">Summary</a>
    <span class="sep">|</span>
    <a
      [routerLink]="['/affidavit/edit']"
      [queryParams]="navQueryParams()"
      class="link"
    >
      Edit data
    </a>
    <span class="sep">|</span>
    <a [routerLink]="['/profile']" [queryParams]="navQueryParams()" class="link">Profile</a>
    <span class="sep">|</span>
    <a (click)="logout()" class="link">Logout</a>
  </nav>

  <p *ngIf="error" class="error">{{ error }}</p>

  <section class="mt16">
    <div class="rowActions">
      <button type="button" (click)="refresh()" [disabled]="busy">Refresh</button>
      <span *ngIf="busy">Loading…</span>
    </div>

    <div *ngIf="summary" class="panel mt12">
      <h2 class="panelTitle">Summary</h2>
      <p>
        Gross annual income: <strong>{{ summary.grossAnnualIncome | number:'1.2-2' }}</strong>
      </p>

      <p class="mt10">
        Annual income (from employment):
        <strong>{{ summary.grossAnnualIncomeFromEmployment | number:'1.2-2' }}</strong>
      </p>
      <p>
        Monthly income (from MonthlyIncome rows):
        <strong>{{ summary.grossMonthlyIncomeFromMonthlyIncome | number:'1.2-2' }}</strong>
      </p>
      <div *ngIf="summary.monthlyIncomeBreakdown?.length" class="mt8">
        <p class="muted">Breakdown:</p>
        <table class="table mt8" style="max-width: 480px;">
          <thead>
            <tr>
              <th class="th">Type</th>
              <th class="th right">Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of summary.monthlyIncomeBreakdown">
              <td class="td">{{ row.typeName }}{{ row.ifOther ? ' — ' + row.ifOther : '' }}</td>
              <td class="td right">{{ row.amount | number:'1.2-2' }}</td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td class="td">Total</td>
              <td class="td right"><strong>{{ summary.grossMonthlyIncomeFromMonthlyIncome | number:'1.2-2' }}</strong></td>
            </tr>
          </tfoot>
        </table>
      </div>
      <p>
        Annual income (from MonthlyIncome rows):
        <strong>{{ summary.grossAnnualIncomeFromMonthlyIncome | number:'1.2-2' }}</strong>
      </p>
      <p>
        Threshold: <strong>{{ summary.threshold | number:'1.0-0' }}</strong>
      </p>

      <p class="mt12">
        Form to generate:
        <strong>{{ summary.form === 'short' ? 'Short form' : 'Long form' }}</strong>
      </p>

      <div class="rowActions mt12">
        <button type="button" (click)="generatePdf()" [disabled]="busy || pdfBusy">Generate PDF</button>
        <span *ngIf="pdfBusy">Generating…</span>
      </div>
    </div>

    <p *ngIf="!busy && !summary && !error" class="mt12">No summary available.</p>
  </section>
</main>
