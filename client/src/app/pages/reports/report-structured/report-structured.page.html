<main class="page">
  <h1>AI Report (Structured)</h1>
  <p class="description">
    Describe the report you want in plain language. Use criteria like respondent income (e.g. &quot;show all respondents making less than 50K/year&quot;).
  </p>

  <p *ngIf="error" class="error">{{ error }}</p>

  <section class="mt16">
    <div class="formRow">
      <label for="prompt">What report do you want?</label>
      <textarea
        id="prompt"
        [(ngModel)]="prompt"
        rows="3"
        placeholder="e.g. Show all respondents making less than 50K per year."
        [disabled]="busy"
      ></textarea>
    </div>
    <div class="rowActions mt12">
      <button type="button" (click)="runReport()" [disabled]="busy">
        {{ busy ? 'Generating…' : 'Generate report' }}
      </button>
    </div>
  </section>

  <section *ngIf="narrative" class="mt16 narrative">
    <h2>Summary</h2>
    <p>{{ narrative }}</p>
  </section>

  <section *ngIf="aboutUserSummary?.bullets?.length" class="mt16 about-user">
    <h2>About this user</h2>
    <ul class="about-user-bullets">
      <li *ngFor="let item of aboutBulletItems"><strong>{{ item.label }}</strong> {{ item.value }}</li>
    </ul>
  </section>

  <section *ngIf="rows.length > 0" class="mt16">
    <h2>Results ({{ rows.length }})</h2>
    <table class="table mt12">
      <thead>
        <tr>
          <th class="th">Case #</th>
          <th class="th">County</th>
          <th class="th">Party</th>
          <th class="th">Role</th>
          <th class="th">Gross annual income</th>
          <th class="th">Under 50K</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows">
          <td class="td">{{ r.caseNumber }}</td>
          <td class="td">{{ r.countyName ?? '—' }}</td>
          <td class="td">{{ r.partyName }}</td>
          <td class="td">{{ r.partyRole }}</td>
          <td class="td">{{ r.grossAnnualIncome | number:'1.2-2' }}</td>
          <td class="td">{{ r.under50K ? 'Yes' : 'No' }}</td>
        </tr>
      </tbody>
    </table>
  </section>

  <p *ngIf="!busy && rows.length === 0 && narrative !== null && narrative !== 'No case found for that user.'" class="mt16">No cases match the requested criteria.</p>
</main>
