<main class="page" [class.pageNoPadding]="hideNav">
  <h1 *ngIf="!hideNav">Edit affidavit data</h1>

  <p *ngIf="!hideNav" class="mt12">
    <a routerLink="/my-cases" class="link">Back to My cases</a>
  </p>

  <p *ngIf="petitionerDisplayName && !hideNav" class="mt12">
    <strong>Petitioner:</strong> {{ petitionerDisplayName }}
  </p>

  <p *ngIf="userId && !hideNav" class="mt12">
    Editing on behalf of userId: <strong>{{ userId }}</strong>
  </p>

  <p *ngIf="error" class="error">{{ error }}</p>

  <section class="panel mt16">
    <h2 class="panelTitle">Step {{ currentStepIndex + 1 }} of {{ steps.length }}: {{ stepTitle() }}</h2>

    <p class="mt12">
      Completed {{ completedStepCount() }} of {{ steps.length }}
    </p>

    <label class="mt12">
      <input
        type="checkbox"
        name="noneToReport"
        [ngModel]="currentNoneSelected"
        (ngModelChange)="onNoneCheckboxChange($event)"
        [disabled]="busy"
      />
      {{ noneLabel(currentStepKey) }}
    </label>

    <ol class="mt12">
      <li *ngFor="let s of steps; let i = index">
        <button type="button" class="link stepLink" (click)="goToStep(i)" [class.stepLinkCurrent]="i === currentStepIndex">
          <strong *ngIf="i === currentStepIndex">{{ s.title }}</strong>
          <span *ngIf="i !== currentStepIndex">{{ s.title }}</span>
        </button>
        <span *ngIf="isStepComplete(s.key)" class="stepDone" aria-label="Done"> âœ”</span>
      </li>
    </ol>
  </section>

  <section class="mt16">
    <app-affidavit-employment-section
      *ngIf="steps[currentStepIndex]?.key === 'employment'"
      [busy]="busy"
      [payFrequencies]="payFrequencies"
      [rows]="employment"
      [userId]="userId"
      (create)="addEmployment($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
      (refresh)="refresh()"
    ></app-affidavit-employment-section>

    <app-affidavit-monthly-lines-section
      *ngIf="steps[currentStepIndex]?.key === 'monthlyIncome'"
      title="Monthly income"
      [busy]="busy"
      [types]="incomeTypes"
      [rows]="monthlyIncome"
      patchType="monthlyIncome"
      [userId]="userId"
      (create)="addMonthlyIncome($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-monthly-lines-section>

    <app-affidavit-monthly-lines-section
      *ngIf="steps[currentStepIndex]?.key === 'monthlyDeductions'"
      title="Monthly deductions"
      [busy]="busy"
      [types]="deductionTypes"
      [rows]="monthlyDeductions"
      patchType="monthlyDeductions"
      [userId]="userId"
      (create)="addMonthlyDeduction($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-monthly-lines-section>

    <app-affidavit-monthly-lines-section
      *ngIf="steps[currentStepIndex]?.key === 'monthlyHouseholdExpenses'"
      title="Monthly household expenses"
      [busy]="busy"
      [types]="householdExpenseTypes"
      [rows]="monthlyHouseholdExpenses"
      patchType="monthlyHouseholdExpenses"
      [userId]="userId"
      (create)="addHouseholdExpense($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-monthly-lines-section>

    <app-affidavit-monthly-lines-section
      *ngIf="steps[currentStepIndex]?.key === 'monthlyAutomobileExpenses'"
      title="Monthly automobile expenses"
      [busy]="busy"
      [types]="automobileExpenseTypes"
      [rows]="monthlyAutomobileExpenses"
      patchType="monthlyAutomobileExpenses"
      [userId]="userId"
      (create)="addMonthlyAutomobileExpense($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-monthly-lines-section>

    <app-affidavit-monthly-lines-section
      *ngIf="steps[currentStepIndex]?.key === 'monthlyChildrenExpenses'"
      title="Monthly children expenses"
      [busy]="busy"
      [types]="childrenExpenseTypes"
      [rows]="monthlyChildrenExpenses"
      patchType="monthlyChildrenExpenses"
      [userId]="userId"
      (create)="addMonthlyChildrenExpense($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-monthly-lines-section>

    <app-affidavit-monthly-lines-section
      *ngIf="steps[currentStepIndex]?.key === 'monthlyChildrenOtherExpenses'"
      title="Monthly children other expenses"
      [busy]="busy"
      [types]="childrenOtherExpenseTypes"
      [rows]="monthlyChildrenOtherExpenses"
      patchType="monthlyChildrenOtherExpenses"
      [userId]="userId"
      (create)="addMonthlyChildrenOtherExpense($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-monthly-lines-section>

    <app-affidavit-monthly-lines-section
      *ngIf="steps[currentStepIndex]?.key === 'monthlyCreditorsExpenses'"
      title="Monthly creditors expenses"
      [busy]="busy"
      [types]="creditorsExpenseTypes"
      [rows]="monthlyCreditorsExpenses"
      patchType="monthlyCreditorsExpenses"
      [userId]="userId"
      (create)="addMonthlyCreditorsExpense($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-monthly-lines-section>

    <app-affidavit-monthly-lines-section
      *ngIf="steps[currentStepIndex]?.key === 'monthlyInsuranceExpenses'"
      title="Monthly insurance expenses"
      [busy]="busy"
      [types]="insuranceExpenseTypes"
      [rows]="monthlyInsuranceExpenses"
      patchType="monthlyInsuranceExpenses"
      [userId]="userId"
      (create)="addMonthlyInsuranceExpense($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-monthly-lines-section>

    <app-affidavit-monthly-lines-section
      *ngIf="steps[currentStepIndex]?.key === 'monthlyOtherExpenses'"
      title="Monthly other expenses"
      [busy]="busy"
      [types]="otherExpenseTypes"
      [rows]="monthlyOtherExpenses"
      patchType="monthlyOtherExpenses"
      [userId]="userId"
      (create)="addMonthlyOtherExpense($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-monthly-lines-section>

    <app-affidavit-assets-section
      *ngIf="steps[currentStepIndex]?.key === 'assets'"
      [busy]="busy"
      [assetsTypes]="assetsTypes"
      [nonMaritalTypes]="nonMaritalTypes"
      [rows]="assets"
      [userId]="userId"
      (create)="addAsset($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-assets-section>

    <app-affidavit-liabilities-section
      *ngIf="steps[currentStepIndex]?.key === 'liabilities'"
      [busy]="busy"
      [liabilitiesTypes]="liabilitiesTypes"
      [nonMaritalTypes]="nonMaritalTypes"
      [rows]="liabilities"
      [userId]="userId"
      (create)="addLiability($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-liabilities-section>

    <app-affidavit-contingent-assets-section
      *ngIf="steps[currentStepIndex]?.key === 'contingentAssets'"
      [busy]="busy"
      [nonMaritalTypes]="nonMaritalTypes"
      [rows]="contingentAssets"
      [userId]="userId"
      (create)="addContingentAsset($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-contingent-assets-section>

    <app-affidavit-contingent-liabilities-section
      *ngIf="steps[currentStepIndex]?.key === 'contingentLiabilities'"
      [busy]="busy"
      [nonMaritalTypes]="nonMaritalTypes"
      [rows]="contingentLiabilities"
      [userId]="userId"
      (create)="addContingentLiability($event)"
      (updateStart)="onSectionUpdateStart()"
      (updateDone)="onSectionUpdateDone()"
      (updateFailed)="onSectionUpdateFailed($event)"
      (remove)="requestRemove($event)"
    ></app-affidavit-contingent-liabilities-section>
  </section>

  <section class="mt16">
    <div class="rowActions">
      <button type="button" (click)="prevStep()" [disabled]="busy || !canGoBack()">Back</button>
      <button
        *ngIf="canGoNext()"
        type="button"
        (click)="nextStep()"
        [disabled]="busy"
        class="submit"
      >
        Next
      </button>
      <button
        *ngIf="!canGoNext()"
        type="button"
        (click)="finish()"
        [disabled]="busy"
        class="submit"
      >
        Finish
      </button>
      <button type="button" (click)="refresh()" [disabled]="busy">Refresh</button>
    </div>
  </section>

  <app-confirm-popup
    [open]="showRemoveConfirm"
    [title]="removeConfirmTitle()"
    message="This cannot be undone."
    confirmText="Remove"
    cancelText="Cancel"
    [danger]="true"
    (confirm)="onConfirmRemove()"
    (cancel)="onCancelRemove()"
  />

  <app-confirm-popup
    [open]="showMonthlyIncomeMismatchConfirm"
    title="Possible data mismatch"
    [message]="monthlyIncomeMismatchMessage"
    confirmText="Continue anyway"
    cancelText="Stay and fix"
    (confirm)="onConfirmMonthlyIncomeMismatchContinue()"
    (cancel)="onCancelMonthlyIncomeMismatch()"
  />

  <app-confirm-popup
    [open]="showNoneConfirm"
    [title]="noneConfirmTitle()"
    [message]="noneConfirmMessage()"
    confirmText="Clear data"
    cancelText="Cancel"
    [danger]="true"
    (confirm)="onConfirmNoneReport()"
    (cancel)="onCancelNoneReport()"
  />
</main>
